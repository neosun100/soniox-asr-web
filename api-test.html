<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soniox ASR API æµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .api-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .api-info {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .response-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”Œ Soniox ASR API æµ‹è¯•</h1>
            <p><a href="index.html" style="color: #4CAF50;">â† è¿”å›ä¸»ç•Œé¢</a> | <a href="http://localhost:8001/docs" target="_blank" style="color: #4CAF50;">ğŸ“– Swagger æ–‡æ¡£</a></p>
        </header>

        <div class="api-section">
            <h2>ğŸ“‹ API ä¿¡æ¯</h2>
            <div class="api-info">
                <p><strong>ç«¯ç‚¹:</strong> POST http://localhost:8001/transcribe</p>
                <p><strong>åŠŸèƒ½:</strong> ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶è¿›è¡Œè½¬å½•ï¼Œè‡ªåŠ¨å¤„ç†è¶…è¿‡60åˆ†é’Ÿçš„æ–‡ä»¶</p>
                <p><strong>ç‰¹æ€§:</strong></p>
                <ul>
                    <li>âœ… è‡ªåŠ¨åˆ‡åˆ†è¶…è¿‡60åˆ†é’Ÿçš„éŸ³é¢‘</li>
                    <li>âœ… API Key å¤±æ•ˆè‡ªåŠ¨é‡è¯•</li>
                    <li>âœ… æ˜¾ç¤ºè¯¦ç»†å¤„ç†æ—¶é•¿</li>
                    <li>âœ… æ”¯æŒäººå£°åˆ†ç¦»</li>
                </ul>
            </div>
        </div>

        <div class="api-section">
            <h2>ğŸ§ª æµ‹è¯• API</h2>
            
            <div class="form-group">
                <label for="testApiKeys">API Keys (é€—å·åˆ†éš”):</label>
                <input type="text" id="testApiKeys" value="" placeholder="è¾“å…¥ API Keys">
            </div>

            <div class="form-group">
                <label for="testFile">é€‰æ‹©éŸ³é¢‘æ–‡ä»¶:</label>
                <input type="file" id="testFile" accept="audio/*,video/*">
            </div>

            <div class="options">
                <label class="switch">
                    <input type="checkbox" id="testDiarization">
                    <span class="slider"></span>
                    <span class="label-text">å¯ç”¨äººå£°åˆ†ç¦»</span>
                </label>
            </div>

            <button id="testApiBtn" class="btn btn-primary">ğŸš€ æµ‹è¯• API</button>

            <div id="testResponse" class="response-box" style="display: none;">
                <h3>ğŸ“Š å“åº”ç»“æœ:</h3>
                <pre id="responseContent"></pre>
            </div>
        </div>

        <div class="api-section">
            <h2>ğŸ’» cURL ç¤ºä¾‹</h2>
            <div class="code-block">
curl -X POST "http://localhost:8001/transcribe" \
  -F "file=@your-audio.mp3" \
  -F "api_keys=YOUR_API_KEY_1,YOUR_API_KEY_2" \
  -F "enable_diarization=false"
            </div>
        </div>

        <div class="api-section">
            <h2>ğŸ Python ç¤ºä¾‹</h2>
            <div class="code-block">
import requests

url = "http://localhost:8001/transcribe"

files = {
    'file': open('your-audio.mp3', 'rb')
}

data = {
    'api_keys': 'YOUR_API_KEY_1,YOUR_API_KEY_2',
    'enable_diarization': 'false'
}

response = requests.post(url, files=files, data=data)
result = response.json()

print(f"è½¬å½•æ–‡æœ¬: {result['text']}")
print(f"å¤„ç†æ—¶é•¿: {result['processing_time']['total']}ç§’")
            </div>
        </div>

        <div class="api-section">
            <h2>ğŸ“ å“åº”æ ¼å¼</h2>
            <div class="code-block">
{
  "success": true,
  "text": "è½¬å½•çš„å®Œæ•´æ–‡æœ¬...",
  "words": [...],
  "audio_duration": 3600.5,
  "total_chunks": 2,
  "processing_time": {
    "total": 45.23,
    "chunks": [
      {"chunk": 1, "duration": 22.5},
      {"chunk": 2, "duration": 21.8}
    ]
  }
}
            </div>
        </div>
    </div>

    <script>
        // API Key æŒä¹…åŒ–
        const API_KEY_STORAGE_KEY = 'soniox_api_keys';
        
        window.addEventListener('DOMContentLoaded', () => {
            const savedKeys = localStorage.getItem(API_KEY_STORAGE_KEY);
            const apiKeyInput = document.getElementById('testApiKeys');
            if (savedKeys) {
                apiKeyInput.value = savedKeys;
            }
            
            apiKeyInput.addEventListener('input', () => {
                const keys = apiKeyInput.value.trim();
                if (keys) {
                    localStorage.setItem(API_KEY_STORAGE_KEY, keys);
                }
            });
        });
        
        document.getElementById('testApiBtn').addEventListener('click', async () => {
            const apiKeys = document.getElementById('testApiKeys').value.trim();
            const fileInput = document.getElementById('testFile');
            const diarization = document.getElementById('testDiarization').checked;
            const responseBox = document.getElementById('testResponse');
            const responseContent = document.getElementById('responseContent');
            const btn = document.getElementById('testApiBtn');

            if (!apiKeys) {
                alert('è¯·è¾“å…¥ API Keys');
                return;
            }

            if (!fileInput.files.length) {
                alert('è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'â³ å¤„ç†ä¸­...';
            responseBox.style.display = 'none';

            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('api_keys', apiKeys);
                formData.append('enable_diarization', diarization);

                const startTime = Date.now();
                const response = await fetch('http://localhost:8001/transcribe', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                const endTime = Date.now();
                const clientTime = ((endTime - startTime) / 1000).toFixed(2);

                if (response.ok) {
                    responseContent.textContent = JSON.stringify(result, null, 2);
                    responseBox.style.display = 'block';
                    alert(`âœ… è½¬å½•æˆåŠŸï¼\nå®¢æˆ·ç«¯è€—æ—¶: ${clientTime}ç§’\næœåŠ¡ç«¯è€—æ—¶: ${result.processing_time.total.toFixed(2)}ç§’`);
                } else {
                    responseContent.textContent = JSON.stringify(result, null, 2);
                    responseBox.style.display = 'block';
                    alert('âŒ è½¬å½•å¤±è´¥: ' + (result.detail || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('âŒ è¯·æ±‚å¤±è´¥: ' + error.message);
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ æµ‹è¯• API';
            }
        });
    </script>
</body>
</html>
